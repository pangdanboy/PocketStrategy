{"ast":null,"code":"import router from './../router/index';\nexport default {\n  name: 'EditStrategy',\n  data: function () {\n    return {\n      title: '',\n      abstract: '大致描述一下你将要书写的攻略内容',\n      content: '',\n      // 设置请求头\n      headers: {\n        enctype: 'multipart/form-data'\n      },\n      // 上传成功之后返回的图片路径\n      imageUrl: '',\n      reqUrl: 'http://localhost:5000/api/uploadImg/imgUpload'\n    };\n  },\n\n  mounted() {\n    // 刷新iscroll\n    this.$emit('refreshScroll');\n  },\n\n  methods: {\n    clear() {\n      console.log('textarea获得焦点');\n\n      if (this.abstract === '大致描述一下你将要书写的攻略内容') {\n        this.abstract = '';\n        this.$refs.textarea.style = 'color: #000000';\n      }\n    },\n\n    addInfo() {\n      if (this.abstract.length === 0) {\n        this.abstract = '大致描述一下你将要书写的攻略内容';\n        this.$refs.textarea.style = 'color: #cccccc';\n      }\n    },\n\n    // 上传成功之后的回调\n    handleAvatarSuccess(res) {\n      // res这个参数自己打印出来一看便知，在此不做解释\n      console.log(res); // 将后端发送的地址赋值到我们需要显示的img中的src动态绑定的参数中\n\n      this.imageUrl = 'http://localhost:5000/' + res.data.path;\n    },\n\n    // 判断上传的图片大小是否满足要求\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg';\n      const isPNG = file.type === 'image/png';\n      const isLt3M = file.size / 1024 / 1024 / 1024 < 3;\n\n      if (!isJPG && !isPNG) {\n        this.$message.error`在这里插入代码片`('上传头像图片只能是 JPG 格式或 png 格式!');\n      }\n\n      if (!isLt3M) {\n        this.$message.error('上传头像图片大小不能超过 3MB!');\n      }\n\n      return isJPG && isLt3M;\n    },\n\n    // 发布攻略\n    release() {\n      if (this.title.length === 0) {\n        this.$message({\n          message: '标题不能为空',\n          type: 'warning'\n        });\n      } else if (this.abstract.length === 0 || this.abstract === '大致描述一下你将要书写的攻略内容') {\n        this.$message({\n          message: '摘要不能为空',\n          type: 'warning'\n        });\n      } else if (this.content.length === 0) {\n        this.$message({\n          message: '内容不能为空',\n          type: 'warning'\n        });\n      } else {\n        this.$axios.post('articles/article', {\n          title: this.title,\n          abstract: this.abstract,\n          content: this.content,\n          cover: this.imageUrl || ''\n        }).then(res => {\n          console.log(res.data); // 清空内容或者设置默认值\n\n          this.title = '';\n          this.abstract = '大致描述一下你将要书写的攻略内容';\n          this.content = '';\n          this.imageUrl = '';\n          this.$message({\n            message: '发布成功',\n            type: 'success'\n          });\n          router.push('/home');\n        }).catch(err => {\n          console.log(err);\n        });\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA0CA;AACA;EACAA,oBADA;EAEAC;IACA;MACAC,SADA;MAEAC,4BAFA;MAGAC,WAHA;MAIA;MACAC;QAAAC;MAAA,CALA;MAMA;MACAC,YAPA;MAQAC;IARA;EAUA,CAbA;;EAcAC;IACA;IACA;EACA,CAjBA;;EAkBAC;IACAC;MACAC;;MACA;QACA;QACA;MACA;IACA,CAPA;;IAQAC;MACA;QACA;QACA;MACA;IACA,CAbA;;IAcA;IACAC;MACA;MACAF,iBAFA,CAGA;;MACA;IACA,CApBA;;IAqBA;IACAG;MACA;MACA;MACA;;MACA;QACA;MACA;;MACA;QACA;MACA;;MACA;IACA,CAjCA;;IAkCA;IACAC;MACA;QACA;UACAC,iBADA;UAEAC;QAFA;MAIA,CALA,MAKA;QACA;UACAD,iBADA;UAEAC;QAFA;MAIA,CALA,MAKA;QACA;UACAD,iBADA;UAEAC;QAFA;MAIA,CALA,MAKA;QACA;UACAhB,iBADA;UAEAC,uBAFA;UAGAC,qBAHA;UAIAe;QAJA,GAKAC,IALA,CAKAC;UACAT,sBADA,CAEA;;UACA;UACA;UACA;UACA;UACA;YACAK,eADA;YAEAC;UAFA;UAIAI;QACA,CAjBA,EAiBAC,KAjBA,CAiBAC;UACAZ;QACA,CAnBA;MAoBA;IACA;;EAzEA;AAlBA","names":["name","data","title","abstract","content","headers","enctype","imageUrl","reqUrl","mounted","methods","clear","console","addInfo","handleAvatarSuccess","beforeAvatarUpload","release","message","type","cover","then","res","router","catch","err"],"sourceRoot":"src/views","sources":["EditStrategy.vue"],"sourcesContent":["<template>\r\n  <div id=\"edit_atlas\">\r\n    <div class=\"edit-atlas\">\r\n      <div class=\"title\">\r\n        <span>标题:</span>\r\n        <input type=\"text\" v-model=\"title\">\r\n      </div>\r\n      <div class=\"abstract\">\r\n        <span>摘要:</span>\r\n        <textarea v-model=\"abstract\" ref=\"textarea\" cols=\"30\" rows=\"3\" @focus=\"clear\" @blur=\"addInfo\"></textarea>\r\n      </div>\r\n      <div class=\"content\">\r\n        <span>内容:</span>\r\n        <textarea name=\"\" id=\"\" cols=\"30\" rows=\"10\" v-model=\"content\"></textarea>\r\n      </div>\r\n      <div class=\"cover-submit\">\r\n        <div class=\"cover\">\r\n          <span>攻略文章封面:</span>\r\n          <el-upload\r\n            :action=\"reqUrl\"\r\n            list-type=\"picture-card\"\r\n            :on-success=\"handleAvatarSuccess\"\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"beforeAvatarUpload\"\r\n            name=\"img\"\r\n            :headers=\"headers\"\r\n            class=\"uploadImg\"\r\n          >\r\n            <!--如果上传成功，后端会传来一个路径，将这个路径动态绑定，便可以显示你上传的图片-->\r\n            <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\" />\r\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n          </el-upload>\r\n        </div>\r\n        <div class=\"submit\">\r\n          <input type=\"submit\" @click.prevent=\"release\" value=\"发布\">\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport router from './../router/index'\r\nexport default {\r\n  name: 'EditStrategy',\r\n  data: function () {\r\n    return {\r\n      title: '',\r\n      abstract: '大致描述一下你将要书写的攻略内容',\r\n      content: '',\r\n      // 设置请求头\r\n      headers: { enctype: 'multipart/form-data' },\r\n      // 上传成功之后返回的图片路径\r\n      imageUrl: '',\r\n      reqUrl: 'http://localhost:5000/api/uploadImg/imgUpload'\r\n    }\r\n  },\r\n  mounted () {\r\n    // 刷新iscroll\r\n    this.$emit('refreshScroll')\r\n  },\r\n  methods: {\r\n    clear () {\r\n      console.log('textarea获得焦点')\r\n      if (this.abstract === '大致描述一下你将要书写的攻略内容') {\r\n        this.abstract = ''\r\n        this.$refs.textarea.style = 'color: #000000'\r\n      }\r\n    },\r\n    addInfo () {\r\n      if (this.abstract.length === 0) {\r\n        this.abstract = '大致描述一下你将要书写的攻略内容'\r\n        this.$refs.textarea.style = 'color: #cccccc'\r\n      }\r\n    },\r\n    // 上传成功之后的回调\r\n    handleAvatarSuccess (res) {\r\n      // res这个参数自己打印出来一看便知，在此不做解释\r\n      console.log(res)\r\n      // 将后端发送的地址赋值到我们需要显示的img中的src动态绑定的参数中\r\n      this.imageUrl = 'http://localhost:5000/' + res.data.path\r\n    },\r\n    // 判断上传的图片大小是否满足要求\r\n    beforeAvatarUpload (file) {\r\n      const isJPG = file.type === 'image/jpeg'\r\n      const isPNG = file.type === 'image/png'\r\n      const isLt3M = file.size / 1024 / 1024 / 1024 < 3\r\n      if (!isJPG && !isPNG) {\r\n        this.$message.error`在这里插入代码片`('上传头像图片只能是 JPG 格式或 png 格式!')\r\n      }\r\n      if (!isLt3M) {\r\n        this.$message.error('上传头像图片大小不能超过 3MB!')\r\n      }\r\n      return isJPG && isLt3M\r\n    },\r\n    // 发布攻略\r\n    release () {\r\n      if (this.title.length === 0) {\r\n        this.$message({\r\n          message: '标题不能为空',\r\n          type: 'warning'\r\n        })\r\n      } else if (this.abstract.length === 0 || this.abstract === '大致描述一下你将要书写的攻略内容') {\r\n        this.$message({\r\n          message: '摘要不能为空',\r\n          type: 'warning'\r\n        })\r\n      } else if (this.content.length === 0) {\r\n        this.$message({\r\n          message: '内容不能为空',\r\n          type: 'warning'\r\n        })\r\n      } else {\r\n        this.$axios.post('articles/article', {\r\n          title: this.title,\r\n          abstract: this.abstract,\r\n          content: this.content,\r\n          cover: this.imageUrl || ''\r\n        }).then(res => {\r\n          console.log(res.data)\r\n          // 清空内容或者设置默认值\r\n          this.title = ''\r\n          this.abstract = '大致描述一下你将要书写的攻略内容'\r\n          this.content = ''\r\n          this.imageUrl = ''\r\n          this.$message({\r\n            message: '发布成功',\r\n            type: 'success'\r\n          })\r\n          router.push('/home')\r\n        }).catch(err => {\r\n          console.log(err)\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  #edit_atlas{\r\n    width: 100vw;\r\n    height: 100vh;\r\n    background: url('./../assets/images/editAtals.jpg') no-repeat;\r\n    background-size: cover;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    .edit-atlas{\r\n      width: 75vw;\r\n      height: 550px;\r\n      background-color: rgba(255, 255, 255, 0.5);\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      justify-content: flex-start;\r\n      padding-top: 10px;\r\n      box-sizing: border-box;\r\n      div{\r\n        width: 90%;\r\n        margin-bottom: 10px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: flex-start;\r\n      }\r\n      .title{\r\n        height: 50px;\r\n        span{\r\n          font-size: 22px;\r\n          font-weight: bolder;\r\n          margin-left: 20px;\r\n          margin-right: 20px;\r\n        }\r\n        input{\r\n          width: 88%;\r\n          height: 40px;\r\n          border: none;\r\n          outline: none;\r\n          font-size: 22px;\r\n          padding: 5px;\r\n          box-sizing: border-box;\r\n        }\r\n      }\r\n      .abstract{\r\n        height: 80px;\r\n        span{\r\n          font-size: 22px;\r\n          font-weight: bolder;\r\n          margin-left: 20px;\r\n          margin-right: 20px;\r\n        }\r\n        textarea{\r\n          outline: none;\r\n          resize: none;\r\n          width: 88%;\r\n          height: 90%;\r\n          border: none;\r\n          padding: 10px;\r\n          box-sizing: border-box;\r\n          color: #cccccc;\r\n        }\r\n      }\r\n      .content{\r\n        height: 250px;\r\n        span{\r\n          font-size: 22px;\r\n          font-weight: bolder;\r\n          margin-left: 20px;\r\n          margin-right: 20px;\r\n        }\r\n        textarea{\r\n          outline: none;\r\n          resize: none;\r\n          width: 88%;\r\n          border: none;\r\n          padding: 10px;\r\n          box-sizing: border-box;\r\n          color: #000000;\r\n        }\r\n      }\r\n      .cover-submit{\r\n        height: 120px;\r\n        margin: 0;\r\n        .cover{\r\n          width: 80%;\r\n          margin: 0;\r\n          span{\r\n            font-size: 22px;\r\n            font-weight: bolder;\r\n            margin-left: 20px;\r\n            margin-right: 20px;\r\n          }\r\n          .uploadImg{\r\n            width: 100px;\r\n            height: 100px;\r\n            margin: 0;\r\n            ::v-deep .el-upload--picture-card{\r\n              width: 100px;\r\n              height: 100px;\r\n              position: relative;\r\n              i{\r\n                position: absolute;\r\n                left: 50%;\r\n                top: 50%;\r\n                transform: translate(-50%, -50%);\r\n              }\r\n            }\r\n          }\r\n          img{\r\n            width: 100%;\r\n            height: 100%;\r\n          }\r\n        }\r\n        .submit{\r\n          width: 100px;\r\n          margin: 0;\r\n          input{\r\n            width: 100px;\r\n            height: 40px;\r\n            border: none;\r\n            border-radius: 5px;\r\n            cursor: pointer;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    @media screen and (min-width: 1450px){\r\n      .edit-atlas{\r\n        height: 700px;\r\n        padding-top: 20px;\r\n        div{\r\n          margin-bottom: 20px;\r\n        }\r\n        .title{\r\n          height: 70px;\r\n        }\r\n        .abstract{\r\n          height: 90px;\r\n        }\r\n        .content{\r\n          height: 300px;\r\n        }\r\n        .cover{\r\n          height: 140px;\r\n        }\r\n      }\r\n    }\r\n    @media screen and (max-width: 1200px){\r\n      .edit-atlas{\r\n        div{\r\n          span{\r\n            font-size: 18px !important;\r\n          }\r\n        }\r\n        .title{\r\n          input{\r\n            width: 85%;\r\n          }\r\n        }\r\n        .abstract{\r\n          textarea{\r\n            width: 85%;\r\n          }\r\n        }\r\n        .content{\r\n          textarea{\r\n            width: 85%;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    @media screen and (max-width: 820px){\r\n      .edit-atlas{\r\n        div{\r\n          span{\r\n            font-size: 16px !important;\r\n          }\r\n        }\r\n        .title{\r\n          input{\r\n            width: 80%;\r\n          }\r\n        }\r\n        .abstract{\r\n          textarea{\r\n            width: 80%;\r\n          }\r\n        }\r\n        .content{\r\n          textarea{\r\n            width: 80%;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}